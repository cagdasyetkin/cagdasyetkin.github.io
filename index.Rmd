---

---

<b> 2018.24.02 </b>

Today we are looking at a quick sentiment analysis of Game of Thrones novels

```{r, warning=FALSE, message=FALSE, results='hide', echo=FALSE}
library(stringr)
library(dplyr)
library(tidyr)
library(tidytext)
library(ggplot2)
library(ggthemes)
library(gridExtra)
library(scales)
library(broom)
library(purrr)
```

```{r, warning=FALSE, message=FALSE, echo=FALSE}
GoT1 <- readLines("GoT1.txt") %>%
  data_frame() %>%
  mutate(title = "A Game of Thrones")

GoT2 <- readLines("GoT2.txt") %>%
  data_frame() %>%
  mutate(title = "A Clash of Kings") 

GoT3 <- readLines("GoT3.txt") %>%
  data_frame() %>%
  mutate(title = "A Storm of Swords") 

GoT4 <- readLines("GoT4.txt") %>%
  data_frame() %>%
  mutate(title = "A Feast of Crows") 

GoT5 <- readLines("GoT5.txt") %>%
  data_frame() %>%
  mutate(title = "A Dance with Dragons") 

Thrones <- bind_rows(list(GoT1, GoT2, GoT3, GoT4, GoT5)) 
colnames(Thrones) <- c("text", "title")


GoT_stopwords <- data_frame(word = c("i'll", "don't", "he's", "it's",
                                     "i'm", "he'd", "man's"), lexicon = 'GoT')

```

Convert to Tidy format
```{r, message=FALSE}
Tidy_Thrones <- Thrones %>%
  group_by(title) %>%
  mutate(linenumber = row_number(), ignore_case = TRUE) %>%
  ungroup() %>%
  unnest_tokens(word, text)

```

```{r, message=FALSE}

GoTsentiment <- Tidy_Thrones %>%
  inner_join(get_sentiments("bing")) %>%
  count(title, index = linenumber %/% 80, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)

```


```{r, fig.width=8,fig.height=6}

ggplot(GoTsentiment, aes(index, sentiment, fill = title)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~title, ncol = 2, scales = "free_x")

```


Is Game of Thrones series really this much negative?



<b> 2018.23.02 </b>

Let's have a look at Game of Thrones, 5 huge volumes

```{r, warning=FALSE, message=FALSE}
GoT1 <- readLines("GoT1.txt") %>%
  data_frame() %>%
  mutate(title = "A Game of Thrones")

GoT2 <- readLines("GoT2.txt") %>%
  data_frame() %>%
  mutate(title = "A Clash of Kings") 

GoT3 <- readLines("GoT3.txt") %>%
  data_frame() %>%
  mutate(title = "A Storm of Swords") 

GoT4 <- readLines("GoT4.txt") %>%
  data_frame() %>%
  mutate(title = "A Feast of Crows") 

GoT5 <- readLines("GoT5.txt") %>%
  data_frame() %>%
  mutate(title = "A Dance with Dragons") 

Thrones <- bind_rows(list(GoT1, GoT2, GoT3, GoT4, GoT5)) 
colnames(Thrones) <- c("text", "title")


```

Convert to Tidy format
```{r, message=FALSE}
Tidy_Thrones <- Thrones %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words)
```
Have a look at the top 10 words in these books
```{r, results=FALSE}
Tidy_Thrones %>%
  count(word, sort = TRUE) %>%
  head(10)
  
```

Looks like lots of lords, sirs and ladies around Jon Snow and Tyrion Lennister :)

```{r, fig.width=4,fig.height=3}

Tidy_Thrones %>%
          count(word, sort = TRUE) %>%
          filter(n > 2300) %>%
          mutate(word = reorder(word, n)) %>%
          ggplot(aes(word, n)) + geom_col() + xlab(NULL) + coord_flip() +
          ggtitle("A Song of Ice and Fire") +
          theme_fivethirtyeight()
```

Now lets see tf-idf to see the most **important** words in these books.

```{r, message=FALSE}
Tidy_Thrones <- Tidy_Thrones %>%
  anti_join(stop_words) %>%
  count(title, word, sort = TRUE) %>%
  ungroup()

Tidy_Thrones_total_words <- Tidy_Thrones %>% 
  group_by(title) %>% 
  summarize(total = sum(n))

Tidy_Thrones <- left_join(Tidy_Thrones, Tidy_Thrones_total_words)

```

```{r}
Tidy_Thrones <- Tidy_Thrones %>%
  bind_tf_idf(word, title, n)
head(Tidy_Thrones)

```

```{r}
Tidy_Thrones %>%
  select(-total) %>%
  arrange(desc(tf_idf)) %>%
  head()

```


```{r, fig.height=12, fig.width=8, message=FALSE}

Tidy_Thrones %>%
        arrange(desc(tf_idf)) %>%
        mutate(word = factor(word, levels = rev(unique(word)))) %>% 
        group_by(title) %>% 
        top_n(10) %>% 
        ungroup %>%
        ggplot(aes(word, tf_idf, fill = title)) +
        geom_col(show.legend = FALSE) +
        labs(x = NULL, y = "tf-idf") +
        facet_wrap(~title, ncol = 2, scales = "free") +
        theme_fivethirtyeight() + ggtitle("A Song of Ice and Fire") +
        coord_flip()
```

Looks like I will need to do **a bit** cleaning :)

<b> 2018.22.02 </b>
A few days ago, I learnt that it is possible to keep a blog up and running using Github and RStudio from our instructor Eduardo Ari√±o de la Rubia.


